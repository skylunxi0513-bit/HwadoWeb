<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>헬 계산기 - 화도웹</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* New styles for the calculator layout */
        .calc-section-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            align-items: center;
            text-align: center;
        }
        .calc-section-grid .label {
            font-weight: bold;
        }
        .calc-section-grid .value {
            font-size: 28px;
            font-weight: bold;
            color: #0056b3;
        }
        .calc-section-grid .pass-value {
            font-size: 14px;
            color: #555;
        }

        .input-item {
            display: grid;
            grid-template-columns: 1fr auto;
            grid-template-rows: auto auto;
            gap: 5px 15px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .input-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .input-item .grade-label {
            grid-column: 1 / 2;
            grid-row: 1 / 2;
            font-weight: bold;
            text-align: left;
        }
        .input-item .expectation-value {
            grid-column: 2 / 3;
            grid-row: 1 / 2;
            text-align: right;
        }
        .input-item .input-controls {
            grid-column: 1 / 2;
            grid-row: 2 / 3;
            display: flex;
            align-items: center;
        }
        .input-item .comparison-value {
            grid-column: 2 / 3;
            grid-row: 2 / 3;
            text-align: right;
        }
        .input-item .pm-btn {
            width: 30px;
            height: 30px;
            font-size: 18px;
            padding: 0;
            line-height: 30px;
            text-align: center;
        }
        .input-item input[type="number"] {
            width: 60px;
            text-align: center;
            margin: 0 5px;
        }
    </style>
</head>
<body>
    <a href="index.html" class="header-link">
        <h1>화도웹</h1>
    </a>

    <div class="calculator-container">
        <div class="calc-section">
            <div class="options-grid">
                <label for="pc-room">PC방</label>
                <input type="checkbox" id="pc-room">
                
                <label for="potion">영약</label>
                <input type="checkbox" id="potion">

                <label for="weekend">주말</label>
                <input type="checkbox" id="weekend">

                <label for="gaze">주시</label>
                <select id="gaze">
                    <option value="none">안돔</option>
                    <option value="first">먼저 돔</option>
                    <option value="last">마지막에 돔</option>
                    <option value="profit">극한의 이득</option>
                </select>
            </div>
        </div>

        <div class="calc-section calc-section-grid">
            <div>
                <div class="label">캐릭 당 헬 판수</div>
                <div id="runs-per-char-display" class="value">20</div>
            </div>
            <div>
                <div class="label">캐릭 당 요구 계시</div>
                <div id="revelation-display" class="value">0 <span id="pass-display" class="pass-value">(패스 0)</span></div>
            </div>
        </div>

        <div class="calc-section">
            <div class="input-item">
                <div class="grade-label">현재 돈 캐릭터 수</div>
                <div class="input-controls">
                    <button class="pm-btn" data-target="char-count" data-op="-1">-</button>
                    <input type="number" id="char-count" value="0" min="0">
                    <button class="pm-btn" data-target="char-count" data-op="1">+</button>
                </div>
            </div>

            <div class="input-item">
                <div class="grade-label">레전더리</div>
                <div id="legendary-exp" class="expectation-value">0</div>
                <div class="input-controls">
                    <button class="pm-btn" data-target="current-legendary" data-op="-1">-</button>
                    <input type="number" id="current-legendary" value="0" min="0">
                    <button class="pm-btn" data-target="current-legendary" data-op="1">+</button>
                </div>
                <div id="legendary-comp" class="comparison-value"></div>
            </div>

            <div class="input-item">
                <div class="grade-label">에픽</div>
                <div id="epic-exp" class="expectation-value">0</div>
                <div class="input-controls">
                    <button class="pm-btn" data-target="current-epic" data-op="-1">-</button>
                    <input type="number" id="current-epic" value="0" min="0">
                    <button class="pm-btn" data-target="current-epic" data-op="1">+</button>
                </div>
                <div id="epic-comp" class="comparison-value"></div>
            </div>

            <div class="input-item">
                <div class="grade-label">태초</div>
                <div id="primal-exp" class="expectation-value">0</div>
                <div class="input-controls">
                    <button class="pm-btn" data-target="current-primal" data-op="-1">-</button>
                    <input type="number" id="current-primal" value="0" min="0">
                    <button class="pm-btn" data-target="current-primal" data-op="1">+</button>
                </div>
                <div id="primal-comp" class="comparison-value"></div>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const pcRoomCheck = document.getElementById('pc-room');
        const potionCheck = document.getElementById('potion');
        const weekendCheck = document.getElementById('weekend');
        const gazeSelect = document.getElementById('gaze');
        const runsDisplay = document.getElementById('runs-per-char-display');
        const revelationDisplay = document.getElementById('revelation-display');
        const passDisplay = document.getElementById('pass-display');
        const charCountInput = document.getElementById('char-count');

        const currentLegendaryInput = document.getElementById('current-legendary');
        const currentEpicInput = document.getElementById('current-epic');
        const currentPrimalInput = document.getElementById('current-primal');

        const legendaryExpDisplay = document.getElementById('legendary-exp');
        const epicExpDisplay = document.getElementById('epic-exp');
        const primalExpDisplay = document.getElementById('primal-exp');

        const legendaryCompDisplay = document.getElementById('legendary-comp');
        const epicCompDisplay = document.getElementById('epic-comp');
        const primalCompDisplay = document.getElementById('primal-comp');
        const plusMinusButtons = document.querySelectorAll('.pm-btn');

        // --- Constants ---
        const EXP_LEGENDARY = 0.03649;
        const EXP_EPIC = 0.01756;
        const EXP_PRIMAL = 0.001602;

        // --- Main Calculation Function ---
        function calculateAndDisplay() {
            // 1. Calculate Runs Per Character
            let baseRuns = 156;
            if (pcRoomCheck.checked) baseRuns += 78;
            if (weekendCheck.checked) baseRuns += 20;

            let runsPerChar = Math.ceil(baseRuns / 8);

            if (potionCheck.checked) runsPerChar += 4;

            switch (gazeSelect.value) {
                case 'first': runsPerChar -= 4; break;
                case 'last': runsPerChar -= 3; break;
                case 'profit': runsPerChar -= 2; break;
            }
            runsDisplay.innerHTML = runsPerChar;

            // 2. Calculate Required Revelations
            const n = pcRoomCheck.checked ? 20 : 22;
            const runsForRevelationCalc = runsPerChar >= 30 ? runsPerChar - 1 : runsPerChar;
            const requiredRevelations = runsForRevelationCalc * n;
            const passValue = runsForRevelationCalc * (n - 2);
            revelationDisplay.innerHTML = `${requiredRevelations} <span class="pass-value">(패스 ${passValue})</span>`;

            // 3. Calculate Expectations
            const charCount = parseInt(charCountInput.value) || 0;
            const totalRuns = charCount * runsPerChar;

            const legendaryExp = totalRuns * EXP_LEGENDARY;
            const epicExp = totalRuns * EXP_EPIC;
            const primalExp = totalRuns * EXP_PRIMAL;

            legendaryExpDisplay.innerHTML = legendaryExp.toFixed(2);
            epicExpDisplay.innerHTML = epicExp.toFixed(2);
            primalExpDisplay.innerHTML = primalExp.toFixed(3);

            // 4. Calculate Comparison
            const currentLegendary = parseInt(currentLegendaryInput.value) || 0;
            const currentEpic = parseInt(currentEpicInput.value) || 0;
            const currentPrimal = parseInt(currentPrimalInput.value) || 0;

            function updateComparison(currentCount, expectedValue, displayElement) {
                const diff = currentCount - expectedValue;
                if (diff >= 0) {
                    displayElement.innerHTML = `+${diff.toFixed(2)}`;
                    displayElement.className = 'comparison-value comparison-plus';
                } else {
                    displayElement.innerHTML = `${diff.toFixed(2)}`;
                    displayElement.className = 'comparison-value comparison-minus';
                }
            }

            updateComparison(currentLegendary, legendaryExp, legendaryCompDisplay);
            updateComparison(currentEpic, epicExp, epicCompDisplay);
            updateComparison(currentPrimal, primalExp, primalCompDisplay);
        }

        // --- Event Listeners ---
        const allInputs = [
            pcRoomCheck, potionCheck, weekendCheck, gazeSelect, charCountInput,
            currentLegendaryInput, currentEpicInput, currentPrimalInput
        ];
        allInputs.forEach(input => {
            input.addEventListener('change', calculateAndDisplay);
            input.addEventListener('input', calculateAndDisplay);
        });

        plusMinusButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetInput = document.getElementById(button.dataset.target);
                const operation = parseInt(button.dataset.op);
                let currentValue = parseInt(targetInput.value) || 0;
                targetInput.value = Math.max(0, currentValue + operation); // Prevent negative numbers
                calculateAndDisplay();
            });
        });

        // --- Initial Setup ---
        function initialize() {
            const today = new Date().getDay(); // 0 = Sunday, 6 = Saturday
            if (today === 0 || today === 6) {
                weekendCheck.checked = true;
            }
            calculateAndDisplay(); // Initial calculation on page load
        }

        initialize();
    </script>

</body>
</html>
